<?xml version="1.0" encoding="UTF-8"?>
<!--
********************************************************
Implementation material for Privacy Policy Format

History:
2023-03-27: First edition

********************************************************
-->
<PolicySet
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:hl7="urn:hl7-org:v3"
	xmlns="urn:oasis:names:tc:xacml:2.0:policy:schema:os"
	PolicySetId="urn:uuid:e693657c-50be-46a6-bdcd-05269147f358"
	PolicyCombiningAlgId="urn:oasis:names:tc:xacml:1.0:policy-combining-algorithm:deny-overrides"> 
	<!-- PolicySetId is generated by the Policy Manager -->
	<Description>
		Patient specific PolicySet for User Assignment 301 - allowing a user (health professional) to access the patient's EPD according to the scope of the referenced access level (PolicySetIdReference below), with delegation
	</Description>
	<Target>
		<Subjects>
			<Subject>
				<SubjectMatch MatchId="urn:oasis:names:tc:xacml:1.0:function:string-equal">
					<!-- GLN of the health professional or ID of a custodian to be authorized -->
					<AttributeValue DataType="http://www.w3.org/2001/XMLSchema#string">2.999</AttributeValue>
					<SubjectAttributeDesignator
						AttributeId="urn:oasis:names:tc:xacml:1.0:subject:subject-id"
					DataType="http://www.w3.org/2001/XMLSchema#string" />
				</SubjectMatch>
				<SubjectMatch MatchId="urn:oasis:names:tc:xacml:1.0:function:string-equal">
					<!--
					According to the EPD SAML 2.0 Assertions Subject element:
					@NameQualifier=”urn:gs1:gln” in case of a professional
					-->
					<AttributeValue DataType="http://www.w3.org/2001/XMLSchema#string">urn:gs1:gln</AttributeValue>
					<SubjectAttributeDesignator
						AttributeId="urn:oasis:names:tc:xacml:1.0:subject:subject-id-qualifier"
					DataType="http://www.w3.org/2001/XMLSchema#string" />
				</SubjectMatch>
				<SubjectMatch MatchId="urn:hl7-org:v3:function:CV-equal">
					<AttributeValue DataType="urn:hl7-org:v3#CV">
						<hl7:CodedValue code="HCP" codeSystem="2.16.756.5.30.1.127.3.10.6" />
					</AttributeValue>
					<SubjectAttributeDesignator
						DataType="urn:hl7-org:v3#CV"
					AttributeId="urn:oasis:names:tc:xacml:2.0:subject:role" />
				</SubjectMatch>
			</Subject>
		</Subjects>
		<Resources>
			<Resource>
				<ResourceMatch MatchId="urn:hl7-org:v3:function:II-equal">
					<AttributeValue DataType="urn:hl7-org:v3#II">
						<!-- epd-spid-goes-here must be replaced with the real EPD-SPID of the patient -->
						<hl7:InstanceIdentifier root="2.16.756.5.30.1.127.3.10.3" extension="epr-spid-goes-here"/>
					</AttributeValue>
					<ResourceAttributeDesignator
						DataType="urn:hl7-org:v3#II"
					AttributeId="urn:e-health-suisse:2015:epr-spid"/>
				</ResourceMatch>

				<!-- When the HCP referenced in SubjectMatch above uses their delegation rights to create
				     a new policy, this statement will assure that the end date of this newly created policy
				     does not exceed the end date of the HCP's delegation rights.  The attribute values below
				     MUST be exactly the same as in the EnvironmentMatch element. -->

				<!-- start date - must be present if present in EnvironmentMatch -->
				<ResourceMatch
						MatchId="urn:oasis:names:tc:xacml:1.0:function:date-less-than-or-equal">
					<AttributeValue	DataType="http://www.w3.org/2001/XMLSchema#date">2023-02-01</AttributeValue>
					<ResourceAttributeDesignator
							AttributeId="urn:e-health-suisse:2023:policy-attributes:start-date"
							DataType="http://www.w3.org/2001/XMLSchema#date"/>
				</ResourceMatch>

				<!-- end date - must be always present (because it is always present in EnvironmentMatch) -->
				<ResourceMatch
						MatchId="urn:oasis:names:tc:xacml:1.0:function:date-greater-than-or-equal">
					<AttributeValue	DataType="http://www.w3.org/2001/XMLSchema#date">2023-02-28</AttributeValue>
					<ResourceAttributeDesignator
							AttributeId="urn:e-health-suisse:2023:policy-attributes:end-date"
							DataType="http://www.w3.org/2001/XMLSchema#date"/>
				</ResourceMatch>

			</Resource>
		</Resources>
		<Environments>
			<Environment>
				<!-- start date - optional -->
				<EnvironmentMatch
						MatchId="urn:oasis:names:tc:xacml:1.0:function:date-less-than-or-equal">
					<AttributeValue	DataType="http://www.w3.org/2001/XMLSchema#date">2023-02-01</AttributeValue>
					<!-- This value must be greater than or equal to the current date -->
					<EnvironmentAttributeDesignator
							AttributeId="urn:oasis:names:tc:xacml:1.0:environment:current-date"
							DataType="http://www.w3.org/2001/XMLSchema#date"/>
				</EnvironmentMatch>
				<!-- end date - required -->
				<EnvironmentMatch
						MatchId="urn:oasis:names:tc:xacml:1.0:function:date-greater-than-or-equal">
					<AttributeValue	DataType="http://www.w3.org/2001/XMLSchema#date">2023-02-28</AttributeValue>
					<!-- This value must be greater than or equal to the current date -->
					<EnvironmentAttributeDesignator
							AttributeId="urn:oasis:names:tc:xacml:1.0:environment:current-date"
							DataType="http://www.w3.org/2001/XMLSchema#date"/>
				</EnvironmentMatch>
			</Environment>
		</Environments>
	</Target>
	<PolicySetIdReference>urn:e-health-suisse:2015:policies:access-level:delegation-and-normal</PolicySetIdReference>
	<!--
	urn:e-health-suisse:2015:policies:access-level:delegation-and-restricted;
	-->
</PolicySet>
